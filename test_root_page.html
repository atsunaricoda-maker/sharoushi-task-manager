<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Root Page Test</title>
</head>
<body>
    <h1>Testing Root Page Access</h1>
    
    <script>
        async function testRootAccess() {
            try {
                console.log('üîß Step 1: Getting emergency auth token...');
                
                // Get emergency auth token first
                const authResponse = await fetch('/api/emergency-auth');
                console.log('Auth response:', authResponse.status, authResponse.statusText);
                
                if (authResponse.ok) {
                    console.log('‚úÖ Emergency auth successful');
                    
                    // Now try to access root page
                    console.log('üîß Step 2: Accessing root page...');
                    const rootResponse = await fetch('/');
                    console.log('Root response:', rootResponse.status, rootResponse.statusText);
                    console.log('Root response URL:', rootResponse.url);
                    
                    if (rootResponse.ok) {
                        const rootText = await rootResponse.text();
                        console.log('Root page content (first 500 chars):', rootText.substring(0, 500));
                        
                        // Look for JavaScript errors in the content
                        if (rootText.includes('value')) {
                            console.log('üîß Found "value" references in root page content');
                            
                            // Extract line around 577
                            const lines = rootText.split('\n');
                            if (lines.length >= 577) {
                                console.log('Line 575:', lines[574]);
                                console.log('Line 576:', lines[575]);
                                console.log('Line 577:', lines[576]);
                                console.log('Line 578:', lines[577]);
                                console.log('Line 579:', lines[578]);
                            }
                        }
                    }
                } else {
                    console.error('‚ùå Emergency auth failed');
                }
                
            } catch (error) {
                console.error('‚ùå Test failed:', error);
            }
        }
        
        // Run test when page loads
        testRootAccess();
    </script>
</body>
</html>